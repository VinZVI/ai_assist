# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é AI-–ö–æ–º–ø–∞–Ω—å–æ–Ω

## üìã –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ AI-–ö–æ–º–ø–∞–Ω—å–æ–Ω, –≤–∫–ª—é—á–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–µ—Å—Ç–æ–≤, –∫–∞—Ä—Ç—É –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞, –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤.

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-09-20  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-15  
**–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞:** 72% (485/1752 —Å—Ç—Ä–æ–∫ –Ω–µ –ø–æ–∫—Ä—ã—Ç—ã)

---

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### –ö–æ—Ä–Ω–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é AI-–ö–æ–º–ø–∞–Ω—å–æ–Ω

## üìã –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ AI-–ö–æ–º–ø–∞–Ω—å–æ–Ω, –≤–∫–ª—é—á–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–µ—Å—Ç–æ–≤, –∫–∞—Ä—Ç—É –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞, –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤.

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-09-20  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-15  
**–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞:** 72% (485/1752 —Å—Ç—Ä–æ–∫ –Ω–µ –ø–æ–∫—Ä—ã—Ç—ã)

---

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### –ö–æ—Ä–Ω–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
tests/
‚îú‚îÄ‚îÄ __init__.py                 # –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–∫–µ—Ç —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ conftest.py                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest –∏ –æ–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ fixtures/                  # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ unit/                      # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_callbacks.py       # –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ callback-–∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ test_config.py         # –¢–µ—Å—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (9.8KB)
‚îÇ   ‚îú‚îÄ‚îÄ test_handlers.py       # –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
‚îÇ   ‚îú‚îÄ‚îÄ test_emotional_profiling.py # –¢–µ—Å—Ç—ã —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ test_content_filter.py # –¢–µ—Å—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ test_models.py         # –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö (20.4KB)
‚îú‚îÄ‚îÄ integration/               # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_ai_manager.py     # –¢–µ—Å—Ç—ã AI –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
‚îÇ   ‚îú‚îÄ‚îÄ test_database.py       # –¢–µ—Å—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (17.3KB)
‚îÇ   ‚îú‚îÄ‚îÄ test_message_handler.py # –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (22.4KB)
‚îÇ   ‚îú‚îÄ‚îÄ test_user_service.py    # –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
‚îÇ   ‚îî‚îÄ‚îÄ test_emotional_support.py # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏
‚îî‚îÄ‚îÄ conftest.py                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest

scripts/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ checks/                    # –°–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ test_config_simple.py  # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (3.3KB)
‚îÇ   ‚îú‚îÄ‚îÄ test_db_connection.py  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î (4.3KB)
‚îÇ   ‚îî‚îÄ‚îÄ test_openrouter_integration.py # –ü—Ä–æ–≤–µ—Ä–∫–∞ OpenRouter (5.6KB)
‚îÇ   ‚îî‚îÄ‚îÄ test_openrouter_simple.py # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ OpenRouter (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
‚îî‚îÄ‚îÄ diagnostics/               # –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã
    ‚îî‚îÄ‚îÄ check_imports.py       # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ (1.8KB)
```

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤

#### üî¨ –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã (`tests/unit/`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –∏–∑–æ–ª—è—Ü–∏–∏
- **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**: –ë—ã—Å—Ç—Ä—ã–µ, –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –º–æ–∫–∏ –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤
- **–§–∞–π–ª—ã**: test_callbacks.py, test_config.py, test_handlers.py, test_models.py, test_emotional_profiling.py, test_content_filter.py

#### üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (`tests/integration/`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**: –ú–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î/API
- **–§–∞–π–ª—ã**: test_ai_manager.py, test_database.py, test_message_handler.py, test_user_service.py, test_emotional_support.py

#### ‚úÖ –°–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ (`scripts/checks/`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**: –ê–≤—Ç–æ–Ω–æ–º–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

#### üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã (`scripts/diagnostics/`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ì–ª—É–±–æ–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**: –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏

---

## üìä –ö–∞—Ä—Ç–∞ –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞ —Ç–µ—Å—Ç–∞–º–∏

### –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü–æ–∫—Ä—ã—Ç–∏–µ | –°—Ç—Ä–æ–∫ –ø–æ–∫—Ä—ã—Ç–æ | –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ | –°—Ç–∞—Ç—É—Å |
|-----------|----------|---------------|-------------|---------|
| **–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** | **72%** | **1267** | **1752** | üü° –ß–∞—Å—Ç—å |

### –î–µ—Ç–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –ø–æ –º–æ–¥—É–ª—è–º

#### ‚úÖ –í—ã—Å–æ–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (80-100%)

| –ú–æ–¥—É–ª—å | –ü–æ–∫—Ä—ã—Ç–∏–µ | –°—Ç—Ä–æ–∫ –Ω–µ –ø–æ–∫—Ä—ã—Ç–æ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|--------|----------|------------------|-------------|
| `app/__init__.py` | 100% | 0/3 | ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã—Ç–æ |
| `app/handlers/__init__.py` | 100% | 0/5 | ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã—Ç–æ |
| `app/keyboards/__init__.py` | 100% | 0/2 | ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã—Ç–æ |
| `app/models/__init__.py` | 100% | 0/4 | ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã—Ç–æ |
| `app/services/__init__.py` | 100% | 0/2 | ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã—Ç–æ |
| `app/services/ai_providers/__init__.py` | 100% | 0/4 | ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã—Ç–æ |
| `app/utils/__init__.py` | 100% | 0/0 | ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã—Ç–æ |
| `app/database.py` | 95% | 7/137 | ‚úÖ –•–æ—Ä–æ—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ |
| `app/config.py` | 89% | 28/254 | ‚úÖ –•–æ—Ä–æ—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ |
| `app/models/conversation.py` | 82% | 21/114 | ‚úÖ –•–æ—Ä–æ—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ |
| `app/models/user.py` | 85% | 15/97 | ‚úÖ –•–æ—Ä–æ—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ |
| `app/middleware/emotional_profiling.py` | 95% | 2/42 | ‚úÖ –•–æ—Ä–æ—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ |
| `app/middleware/content_filter.py` | 92% | 3/38 | ‚úÖ –•–æ—Ä–æ—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ |

#### üü° –°—Ä–µ–¥–Ω–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (50-79%)

| –ú–æ–¥—É–ª—å | –ü–æ–∫—Ä—ã—Ç–∏–µ | –°—Ç—Ä–æ–∫ –Ω–µ –ø–æ–∫—Ä—ã—Ç–æ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|--------|----------|------------------|-------------|
| `app/services/ai_manager.py` | 67% | 61/185 | üü° –ù—É–∂–¥–∞–µ—Ç—Å—è –≤ –¥–æ—Ä–∞–±–æ—Ç–∫–µ |
| `app/services/ai_providers/base.py` | 65% | 26/74 | üü° –ù—É–∂–¥–∞–µ—Ç—Å—è –≤ –¥–æ—Ä–∞–±–æ—Ç–∫–µ |
| `app/utils/logging.py` | 59% | 23/56 | üü° –ù—É–∂–¥–∞–µ—Ç—Å—è –≤ –¥–æ—Ä–∞–±–æ—Ç–∫–µ |
| `app/log_lexicon/__init__.py` | 100% | 0/4 | ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã—Ç–æ |
| `app/log_lexicon/en.py` | 100% | 0/130 | ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã—Ç–æ |
| `app/log_lexicon/ru.py` | 100% | 0/130 | ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã—Ç–æ |

#### üî¥ –ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (0-49%)

| –ú–æ–¥—É–ª—å | –ü–æ–∫—Ä—ã—Ç–∏–µ | –°—Ç—Ä–æ–∫ –Ω–µ –ø–æ–∫—Ä—ã—Ç–æ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|--------|----------|------------------|-----------|
| `app/handlers/callbacks.py` | 28% | 84/116 | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–æ |
| `app/handlers/message.py` | 45% | 71/129 | üü° –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ |
| `app/keyboards/inline.py` | 23% | 43/56 | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–æ |
| `app/handlers/start.py` | 20% | 68/85 | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–æ |
| `app/services/ai_manager.py` | 18% | 145/177 | üî¥ **–ü–†–ò–û–†–ò–¢–ï–¢ 1** |
| `app/services/ai_providers/openrouter.py` | 13% | 109/126 | üî¥ **–ü–†–ò–û–†–ò–¢–ï–¢ 2** |

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–∑ –ø–æ–∫—Ä—ã—Ç–∏—è

#### üö® –í—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

1. **`app/services/ai_manager.py` (18% –ø–æ–∫—Ä—ã—Ç–∏—è)**
   - **–§—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –ø–æ–∫—Ä—ã—Ç–∏—è**: 
     - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AIManager
     - –ú–µ—Ö–∞–Ω–∏–∑–º fallback –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
     - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
     - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
     - Health check –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: –ö–ª—é—á–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

2. **`app/services/ai_providers/openrouter.py` (13% –ø–æ–∫—Ä—ã—Ç–∏—è)**
   - **–§—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –ø–æ–∫—Ä—ã—Ç–∏—è**:
     - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è OpenRouter –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
     - HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ OpenRouter API
     - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API (401, 402, 429, 5xx)
     - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
     - –õ–æ–≥–∏–∫–∞ fallback –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: –û—Å–Ω–æ–≤–Ω–æ–π –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

#### üî• –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

4. **`app/handlers/message.py` (26% –ø–æ–∫—Ä—ã—Ç–∏—è)**
   - **–§—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –ø–æ–∫—Ä—ã—Ç–∏—è**:
     - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–æ–≤—ã–º AIManager
     - –û–±—Ä–∞–±–æ—Ç–∫–∞ fallback –ª–æ–≥–∏–∫–∏
     - –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
     - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

5. **`app/handlers/callbacks.py` (28% –ø–æ–∫—Ä—ã—Ç–∏—è)**
   - **–§—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –ø–æ–∫—Ä—ã—Ç–∏—è**:
     - Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
     - Callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
     - –ü—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏–∏
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

---

## üß™ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–µ—Å—Ç–∞–º

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤ | –°—Ç–∞—Ç—É—Å |
|-----------|-------------------|---------|
| **–í—Å–µ–≥–æ —Å–æ–±—Ä–∞–Ω–æ** | 245 —Ç–µ—Å—Ç–æ–≤ | ‚úÖ |
| **–ü—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ** | 182 —Ç–µ—Å—Ç–æ–≤ | ‚úÖ |
| **–ü—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å** | 33 —Ç–µ—Å—Ç–æ–≤ | ‚ùå |
| **–ü—Ä–æ–ø—É—â–µ–Ω—ã** | 15 —Ç–µ—Å—Ç–æ–≤ | ‚è≠Ô∏è |
| **–û—à–∏–±–∫–∏** | 7 —Ç–µ—Å—Ç–æ–≤ | üí• |

### –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Ñ–∞–π–ª–∞–º

#### üìÅ tests/unit/test_config.py
- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤**: 11
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- **–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**:
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å .env.example —Ñ–∞–π–ª–æ–º
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π Pydantic
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º

#### üìÅ tests/unit/test_models.py  
- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤**: 25
- **–°—Ç–∞—Ç—É—Å**: üü° –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- **–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**:
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ç–µ–∫—É—â–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏ SQLAlchemy
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ —Ñ–∏–∫—Å—Ç—É—Ä–∞–º–∏
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–æ–ª–µ–π –≤ User –º–æ–¥–µ–ª–∏
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å Pydantic —Å—Ö–µ–º–∞–º–∏

#### üìÅ tests/unit/test_emotional_profiling.py
- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤**: 12
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ EmotionalProfilingMiddleware
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

#### üìÅ tests/unit/test_content_filter.py
- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤**: 14
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ContentFilterMiddleware
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —ç–∫—Å—Ç—Ä–µ–º–∏—Å—Ç—Å–∫–æ–≥–æ –∏ –Ω–µ–∑–∞–∫–æ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

#### üìÅ tests/unit/test_emotional_support_prompts.py
- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤**: 8
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ –∫—Ä–∏–∑–∏—Å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö

#### üìÅ tests/integration/test_emotional_support.py
- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤**: 16
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω–≤–µ–π–µ—Ä–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫—Ä–∏–∑–∏—Å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π

#### üìÅ tests/load_test.py
- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤**: 1 (–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç)
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
  - –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –∑–¥–æ—Ä–æ–≤—å—è –∏ –º–µ—Ç—Ä–∏–∫
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
  - –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞ –∏ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

---

## üß™ –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏

### –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã

#### EmotionalProfilingMiddleware
- **test_emotional_profiling_middleware_initialization**: –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ middleware
- **test_emotional_profiling_middleware_call_with_message**: –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
- **test_emotional_profiling_middleware_call_without_user**: –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **test_emotional_profiling_middleware_call_with_callback_query**: –¢–µ—Å—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è callback-–∑–∞–ø—Ä–æ—Å–æ–≤
- **test_extract_emotional_indicators_positive_text**: –¢–µ—Å—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏–∑ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- **test_extract_emotional_indicators_negative_text**: –¢–µ—Å—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏–∑ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- **test_extract_emotional_indicators_neutral_text**: –¢–µ—Å—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏–∑ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- **test_extract_emotional_indicators_with_topics**: –¢–µ—Å—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–µ–º –≤ —Ç–µ–∫—Å—Ç–µ
- **test_analyze_user_emotions_success**: –¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —ç–º–æ—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **test_analyze_user_emotions_exception_handling**: –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ –∞–Ω–∞–ª–∏–∑–µ —ç–º–æ—Ü–∏–π

#### ContentFilterMiddleware
- **test_content_filter_middleware_initialization**: –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ middleware
- **test_content_filter_middleware_call_with_clean_message**: –¢–µ—Å—Ç –ø—Ä–æ–ø—É—Å–∫–∞ —á–∏—Å—Ç—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **test_content_filter_middleware_block_extremist_content**: –¢–µ—Å—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —ç–∫—Å—Ç—Ä–µ–º–∏—Å—Ç—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **test_content_filter_middleware_block_illegal_content**: –¢–µ—Å—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–µ–∑–∞–∫–æ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **test_content_filter_middleware_warn_personal_data**: –¢–µ—Å—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **test_content_filter_middleware_call_with_callback_query**: –¢–µ—Å—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è callback-–∑–∞–ø—Ä–æ—Å–æ–≤
- **test_filter_content_allow_normal_text**: –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- **test_filter_content_block_extremist_keywords**: –¢–µ—Å—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —ç–∫—Å—Ç—Ä–µ–º–∏—Å—Ç—Å–∫–∏—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
- **test_filter_content_block_illegal_keywords**: –¢–µ—Å—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–µ–∑–∞–∫–æ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
- **test_filter_content_warn_personal_data_patterns**: –¢–µ—Å—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **test_get_content_filter_stats**: –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- **test_reset_content_filter_stats**: –¢–µ—Å—Ç —Å–±—Ä–æ—Å–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

#### AI Prompts –¥–ª—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- **test_create_system_message_russian**: –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- **test_create_system_message_english**: –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
- **test_create_crisis_intervention_prompt_russian**: –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ –∫—Ä–∏–∑–∏—Å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- **test_create_crisis_intervention_prompt_english**: –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ –∫—Ä–∏–∑–∏—Å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
- **test_create_mature_content_prompt_russian**: –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- **test_create_mature_content_prompt_english**: –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
- **test_prompts_contain_important_guidelines**: –¢–µ—Å—Ç –Ω–∞–ª–∏—á–∏—è –≤–∞–∂–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö
- **test_crisis_intervention_prompts_have_safety_focus**: –¢–µ—Å—Ç —Ñ–æ–∫—É—Å–∞ –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞
- **test_mature_content_prompts_have_appropriate_guidelines**: –¢–µ—Å—Ç –Ω–∞–ª–∏—á–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö –¥–ª—è –≤–∑—Ä–æ—Å–ª–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
- **test_emotional_support_message_processing**: –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- **test_content_filtering_with_emotional_content**: –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
- **test_emotional_profiling_integration**: –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- **test_crisis_situation_handling**: –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫—Ä–∏–∑–∏—Å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π
- **test_mature_content_handling**: –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö
- **test_emotional_support_with_content_filtering**: –¢–µ—Å—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞

---

## üìù –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é —Ç–µ—Å—Ç–æ–≤

### –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º –∏ –Ω–µ –≤–ª–∏—è—Ç—å –Ω–∞ –¥—Ä—É–≥–∏–µ —Ç–µ—Å—Ç—ã
2. **–ü–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å**: –¢–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –¥–∞–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ
3. **–°–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ù–∞–∑–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã —è—Å–Ω–æ –æ—Ç—Ä–∞–∂–∞—Ç—å, —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è
4. **–ü–æ–∫—Ä—ã—Ç–∏–µ edge cases**: –¢–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø–æ–∫—Ä—ã–≤–∞—Ç—å –∫–∞–∫ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ, —Ç–∞–∫ –∏ –ø–æ–≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
import pytest
from unittest.mock import AsyncMock, MagicMock, patch

# –ò–º–ø–æ—Ä—Ç—ã —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

@pytest.mark.asyncio
async def test_descriptive_test_name():
    """–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è"""
    # Arrange - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    # ... –∫–æ–¥ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ ...
    
    # Act - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–¥–∞
    # ... –∫–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ...
    
    # Assert - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    # ... –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ ...
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä

–§–∏–∫—Å—Ç—É—Ä—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –≤ `conftest.py` –∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ —Ç–µ—Å—Ç–∞—Ö:

```
# –í conftest.py
@pytest.fixture
def mock_user():
    """Create a mock user for testing."""
    user = MagicMock(spec=UserModel)
    user.id = 123456789
    user.telegram_id = 123456789
    return user

# –í —Ç–µ—Å—Ç–µ
def test_something_with_user(mock_user):
    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ mock_user
    pass
```

### –ú–æ–∫–∏ –∏ –ø–∞—Ç—á–∏

–î–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–æ–∫–∏:

```
# –ú–æ–∫ –æ–±—ä–µ–∫—Ç–∞
mock_handler = AsyncMock()

# –ü–∞—Ç—á –º–æ–¥—É–ª—è –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏
with patch('module.function') as mock_function:
    mock_function.return_value = expected_result
    # ... —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–¥ ...
```

---

## üìà –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ —Ç–µ—Å—Ç–∞–º–∏

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏

```
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
pytest --cov=app --cov-report=html --cov-report=term

# –û—Ç–∫—Ä—ã—Ç–∏–µ HTML –æ—Ç—á–µ—Ç–∞
open htmlcov/index.html
```

### –¶–µ–ª–∏ –ø–æ–∫—Ä—ã—Ç–∏—è

- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: 90%+
- **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: 80%+
- **–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: 70%+

---

## üîÑ –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD

–í—Å–µ —Ç–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –î–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è CI/CD –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. –í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —É—Å–ø–µ—à–Ω–æ
2. –ü–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 80%
3. –ö–æ–¥ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ª–∏–Ω—Ç–µ—Ä–æ–º

### –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–µ—Ä–æ–º
ruff check

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
ruff format

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
mypy app
```